---
import { getLocalizedPath, type Locale } from '../../utils/i18n';
import type { getTranslations } from '../../utils/i18n';

interface Props {
  currentPage: number;
  totalPages: number;
  basePath: string;
  locale: Locale;
  translations: ReturnType<typeof getTranslations>;
}

const { currentPage, totalPages, basePath, locale, translations } = Astro.props;
const t = translations.pagination;

// Generate page numbers to display
function getPageNumbers(current: number, total: number): (number | string)[] {
  const pages: (number | string)[] = [];

  if (total <= 7) {
    // Show all pages if 7 or fewer pages
    for (let i = 1; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);

    if (current > 3) {
      pages.push('...');
    }

    // Show pages around current page
    const start = Math.max(2, current - 1);
    const end = Math.min(total - 1, current + 1);

    for (let i = start; i <= end; i++) {
      pages.push(i);
    }

    if (current < total - 2) {
      pages.push('...');
    }

    // Always show last page
    pages.push(total);
  }

  return pages;
}

const pageNumbers = getPageNumbers(currentPage, totalPages);
const hasPrevious = currentPage > 1;
const hasNext = currentPage < totalPages;

function getPageUrl(page: number): string {
  if (page === 1) {
    return getLocalizedPath(basePath, locale);
  }
  return getLocalizedPath(`${basePath}/page/${page}`, locale);
}
---

{
  totalPages > 1 && (
    <nav class="mt-12 flex items-center justify-center gap-2" aria-label="Pagination">
      {/* Previous button */}
      <a
        href={hasPrevious ? getPageUrl(currentPage - 1) : undefined}
        class={`flex items-center gap-1 rounded-lg px-4 py-2 text-sm font-medium transition-colors ${
          hasPrevious
            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'
            : 'cursor-not-allowed bg-gray-100 text-gray-400 dark:bg-gray-900 dark:text-gray-600'
        }`}
        aria-disabled={!hasPrevious}
        aria-label={t.previous}
      >
        <svg
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        <span class="hidden sm:inline">{t.previous}</span>
      </a>

      {/* Page numbers */}
      <div class="flex items-center gap-1">
        {pageNumbers.map((page) => {
          if (page === '...') {
            return <span class="px-2 py-2 text-gray-500 dark:text-gray-400">...</span>;
          }

          const pageNum = page as number;
          const isActive = pageNum === currentPage;

          return (
            <a
              href={getPageUrl(pageNum)}
              class={`rounded-lg px-4 py-2 text-sm font-medium transition-colors ${
                isActive
                  ? 'bg-blue-600 text-white dark:bg-blue-500'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'
              }`}
              aria-label={`${t.page} ${pageNum}`}
              aria-current={isActive ? 'page' : undefined}
            >
              {pageNum}
            </a>
          );
        })}
      </div>

      {/* Next button */}
      <a
        href={hasNext ? getPageUrl(currentPage + 1) : undefined}
        class={`flex items-center gap-1 rounded-lg px-4 py-2 text-sm font-medium transition-colors ${
          hasNext
            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'
            : 'cursor-not-allowed bg-gray-100 text-gray-400 dark:bg-gray-900 dark:text-gray-600'
        }`}
        aria-disabled={!hasNext}
        aria-label={t.next}
      >
        <span class="hidden sm:inline">{t.next}</span>
        <svg
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </nav>
  )
}
