---
import { getTranslations, getLocalizedPath, type Locale } from '../../utils/i18n';
import { calculateReadingTime, formatReadingTime } from '../../utils/readingTime';
import type { CollectionEntry } from 'astro:content';

interface Props {
  posts: CollectionEntry<'notes'>[];
  locale: Locale;
}

const { posts, locale } = Astro.props;
const t = getTranslations(locale);
---

<!-- Latest Notes Section -->{
  posts.length > 0 && (
    <section class="mt-20">
      <div class="mb-8 flex items-center justify-between">
        <h2 class="text-2xl font-light text-gray-900 dark:text-gray-100">{t.site.latestNotes}</h2>
        <a
          href={getLocalizedPath('/notes', locale)}
          class="text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"
        >
          {t.site.viewAll} →
        </a>
      </div>

      <div class="space-y-12">
        {posts.map((post) => {
          const postSlug = post.slug.replace(/\/id$|\/en$/, '');
          const postPath = getLocalizedPath(`/notes/${postSlug}`, locale);
          const dateLocale = locale === 'id' ? 'id-ID' : 'en-US';

          return (
            <article class="group">
              <time
                class="mb-2 block text-sm text-gray-500 dark:text-gray-500"
                datetime={post.data.pubDate.toISOString()}
              >
                {post.data.pubDate.toLocaleDateString(dateLocale, {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </time>
              <h3 class="mb-3 text-2xl font-light text-gray-900 dark:text-gray-100">
                <a
                  href={postPath}
                  class="transition-colors hover:text-gray-600 dark:hover:text-gray-300"
                >
                  {post.data.title}
                </a>
              </h3>
              <p class="mb-4 text-gray-600 dark:text-gray-400">{post.data.description}</p>
              <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-500">
                <span>
                  {(() => {
                    const readingTime = calculateReadingTime(post.body);
                    return readingTime < 1
                      ? t.notes.underOneMinute
                      : `${formatReadingTime(readingTime, locale)} ${t.notes.minRead}`;
                  })()}
                </span>
                {post.data.tags && post.data.tags.length > 0 && (
                  <>
                    <span>•</span>
                    <div class="flex flex-wrap gap-2">
                      {post.data.tags.slice(0, 3).map((tag) => (
                        <span class="text-gray-400 dark:text-gray-600">#{tag}</span>
                      ))}
                    </div>
                  </>
                )}
              </div>
            </article>
          );
        })}
      </div>
    </section>
  )
}

{
  posts.length === 0 && (
    <div class="mt-20 text-center">
      <p class="text-gray-500 dark:text-gray-500">
        {locale === 'id' ? 'Belum ada catatan.' : 'No notes yet.'}
      </p>
    </div>
  )
}

<style>
  /* Minimalist styling for home page */
  article {
    @apply border-b border-gray-200 pb-12 last:border-0 last:pb-0 dark:border-gray-800;
  }

  article:last-child {
    @apply border-0;
  }

  /* Subtle hover effect on links */
  article h3 a {
    @apply transition-all duration-200;
  }

  article:hover h3 a {
    @apply text-gray-700 dark:text-gray-200;
  }
</style>
