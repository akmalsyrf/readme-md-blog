---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getTranslations, getLocaleFromPath } from '../../utils/i18n';
import { getCheatsheetsByCategory, getCategories } from '../../utils/getCheatsheetsByCategory';

const currentPath = Astro.url.pathname;
const locale = getLocaleFromPath(currentPath);
const t = getTranslations(locale);

// Get all categories
const categories = await getCategories();
const cheatsheetsByCategory = await getCheatsheetsByCategory();
---

<BaseLayout title={t.cheatsheet.title} description={t.site.description}>
  <div class="container mx-auto px-4 py-12">
    <div class="mx-auto max-w-4xl">
      <h1 class="mb-6 text-4xl font-bold">{t.cheatsheet.title}</h1>

      {/* Category List */}
      {
        categories.length > 0 ? (
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {categories.map((category) => {
              const cheatsheets = cheatsheetsByCategory[category] || [];
              const count = cheatsheets.length;
              // Use encodeURI to properly encode the category in the URL
              const categoryUrl = `/cheatsheet/category/${encodeURI(category)}`;

              return (
                <a
                  href={categoryUrl}
                  class="group rounded-lg border border-gray-200 bg-white p-6 transition-all hover:border-blue-500 hover:shadow-lg dark:border-gray-800 dark:bg-gray-800 dark:hover:border-blue-400"
                >
                  <h2 class="mb-2 text-xl font-semibold text-gray-900 group-hover:text-blue-600 dark:text-gray-100 dark:group-hover:text-blue-400">
                    {category}
                  </h2>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    {count}{' '}
                    {locale === 'id' ? 'cheatsheet' : count === 1 ? 'cheatsheet' : 'cheatsheets'}
                  </p>
                </a>
              );
            })}
          </div>
        ) : (
          <p class="text-gray-600 dark:text-gray-400">{t.cheatsheet.noCheatsheets}</p>
        )
      }
    </div>
  </div>
</BaseLayout>
