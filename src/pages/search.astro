---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getTranslations, getLocaleFromPath } from '../utils/i18n';
import { getCollection } from 'astro:content';
import SearchContent from '../components/search/SearchContent.astro';

const currentPath = Astro.url.pathname;
const locale = getLocaleFromPath(currentPath);
const t = getTranslations(locale);

// Get blog posts - filter by locale (only published)
const allPosts = await getCollection('notes');
const posts = allPosts
  .filter((post) => {
    if (!post.data.isPublished) {
      return false;
    }
    const slug = post.slug;
    if (locale === 'id') {
      return slug.endsWith('/id');
    } else {
      return slug.endsWith('/en');
    }
  })
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title={t.search.title} description={t.search.title}>
  <div class="container mx-auto px-4 py-12">
    <div class="mx-auto max-w-4xl">
      <h1 class="mb-4 text-4xl font-bold">{t.search.title}</h1>

      <SearchContent posts={posts} locale={locale} t={t} />
    </div>
  </div>
</BaseLayout>
