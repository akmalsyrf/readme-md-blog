---
import { getTranslations, getLocalizedPath, type Locale } from '../../utils/i18n';
import type { CollectionEntry } from 'astro:content';

interface Props {
  posts: CollectionEntry<'notes'>[];
  locale: Locale;
}

const { posts, locale } = Astro.props;
const t = getTranslations(locale);

// Count posts by tag
const tagMap = new Map<string, number>();

posts.forEach((post) => {
  if (post.data.tags && post.data.tags.length > 0) {
    post.data.tags.forEach((tag) => {
      const count = tagMap.get(tag) || 0;
      tagMap.set(tag, count + 1);
    });
  }
});

// Convert to array and sort alphabetically
const tags = Array.from(tagMap.entries())
  .map(([tag, count]) => ({ tag, count }))
  .sort((a, b) => a.tag.localeCompare(b.tag));
---

{
  tags.length > 0 ? (
    <div class="flex flex-wrap gap-4">
      {tags.map(({ tag, count }) => {
        const tagPath = getLocalizedPath(`/tags/${tag}`, locale);
        return (
          <a
            href={tagPath}
            class="inline-flex items-baseline rounded-lg bg-gray-100 px-4 py-2.5 text-base font-medium text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
          >
            <span>{tag}</span>
            <sup class="ml-1.5 text-xs font-normal leading-none">{count}</sup>
          </a>
        );
      })}
    </div>
  ) : (
    <p class="text-gray-600 dark:text-gray-400">{t.tags.noTags}</p>
  )
}
