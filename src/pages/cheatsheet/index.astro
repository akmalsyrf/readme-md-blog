---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getTranslations, getLocaleFromPath } from '../../utils/i18n';
import { getCheatsheets } from '../../utils/getCheatsheets';
import type { CollectionEntry } from 'astro:content';

const currentPath = Astro.url.pathname;
const locale = getLocaleFromPath(currentPath);
const t = getTranslations(locale);

// Get all cheatsheets
const cheatsheets = await getCheatsheets();
---

<BaseLayout title={t.cheatsheet.title} description={t.site.description}>
  <div class="container mx-auto px-4 py-12">
    <div class="mx-auto max-w-4xl">
      <h1 class="mb-6 text-4xl font-bold">{t.cheatsheet.title}</h1>

      {
        cheatsheets.length > 0 ? (
          <div class="grid gap-6 md:grid-cols-2">
            {cheatsheets.map((cheatsheet: CollectionEntry<'cheatsheet'>) => (
              <article class="rounded-lg border border-gray-200 bg-white p-6 transition-shadow hover:shadow-lg dark:border-gray-800 dark:bg-gray-800">
                <h2 class="mb-2 text-xl font-semibold">
                  <a
                    href={`/cheatsheet/${cheatsheet.slug}`}
                    class="hover:text-blue-600 dark:hover:text-blue-400"
                  >
                    {cheatsheet.data.title}
                  </a>
                </h2>
                <p class="mb-4 text-gray-600 dark:text-gray-400">{cheatsheet.data.description}</p>
                <div class="mb-4 flex items-center gap-2 text-xs text-gray-500 dark:text-gray-500">
                  <time>
                    {cheatsheet.data.pubDate.toLocaleDateString(
                      locale === 'id' ? 'id-ID' : 'en-US',
                      {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                      }
                    )}
                  </time>
                </div>
                <div class="flex items-center justify-end">
                  <a
                    href={`/cheatsheet/${cheatsheet.slug}`}
                    class="text-sm font-medium text-blue-600 hover:underline dark:text-blue-400"
                  >
                    {t.cheatsheet.readMore} â†’
                  </a>
                </div>
                {cheatsheet.data.tags && cheatsheet.data.tags.length > 0 && (
                  <div class="mt-4 flex flex-wrap gap-2">
                    {cheatsheet.data.tags.map((tag: string) => (
                      <span class="rounded-full bg-blue-100 px-2 py-1 text-xs text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </article>
            ))}
          </div>
        ) : (
          <p class="text-gray-600 dark:text-gray-400">{t.cheatsheet.noCheatsheets}</p>
        )
      }
    </div>
  </div>
</BaseLayout>
