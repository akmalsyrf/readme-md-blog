---
import { getTranslations, type Locale } from '../../utils/i18n';

interface Props {
  locale?: string;
}

const { locale = 'id' } = Astro.props;
const t = getTranslations(locale as Locale);
---

<div class="theme-toggle-container" role="radiogroup" aria-label={t.theme.toggle}>
  <label for="theme-light" class="theme-radio-label theme-radio-light">
    <input type="radio" id="theme-light" name="theme" value="light" class="theme-radio-input" />
    <span class="theme-radio-content">
      <svg
        class="theme-icon"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
          clip-rule="evenodd"></path>
      </svg>
      <span class="theme-label-text">{t.theme.light}</span>
    </span>
  </label>

  <label for="theme-dark" class="theme-radio-label theme-radio-dark">
    <input type="radio" id="theme-dark" name="theme" value="dark" class="theme-radio-input" />
    <span class="theme-radio-content">
      <svg
        class="theme-icon"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
      </svg>
      <span class="theme-label-text">{t.theme.dark}</span>
    </span>
  </label>
</div>

<script>
  (function () {
    const lightRadio = document.getElementById('theme-light');
    const darkRadio = document.getElementById('theme-dark');

    // Check for saved theme preference or default to system preference
    const storedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const currentTheme = storedTheme || (prefersDark ? 'dark' : 'light');

    // Sync radio buttons with current theme (theme already applied by blocking script in head)
    if (currentTheme === 'dark') {
      darkRadio.checked = true;
    } else {
      lightRadio.checked = true;
    }

    // Ensure theme-loaded class is present for transitions
    if (!document.documentElement.classList.contains('theme-loaded')) {
      document.documentElement.classList.add('theme-loaded');
    }

    // Handle theme change
    function handleThemeChange(theme) {
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }
    }

    // Handle theme change for both click and touch
    function setupThemeRadio(radio, theme) {
      // Click event (desktop)
      radio.addEventListener('change', () => {
        if (radio.checked) {
          handleThemeChange(theme);
        }
      });

      // Touch event (mobile) - trigger on touchstart for immediate feedback
      radio.addEventListener(
        'touchstart',
        (e) => {
          e.stopPropagation();
          radio.checked = true;
          handleThemeChange(theme);
        },
        { passive: true }
      );
    }

    if (lightRadio) setupThemeRadio(lightRadio, 'light');
    if (darkRadio) setupThemeRadio(darkRadio, 'dark');
  })();
</script>

<style>
  .theme-toggle-container {
    @apply flex items-center gap-1 rounded-lg border border-gray-300 bg-white p-1 dark:border-gray-700 dark:bg-gray-800;
  }

  .theme-radio-label {
    @apply relative flex cursor-pointer items-center gap-2 rounded-md px-3 py-2 transition-all duration-200;
    @apply hover:bg-gray-100 dark:hover:bg-gray-700;
  }

  .theme-radio-input {
    @apply sr-only;
  }

  .theme-radio-content {
    @apply flex items-center gap-2;
  }

  .theme-icon {
    @apply h-4 w-4 transition-colors;
  }

  .theme-label-text {
    @apply text-sm font-medium transition-colors;
  }

  /* Light mode active state - using class-based approach for better mobile support */
  .theme-radio-light input:checked + .theme-radio-content,
  .theme-radio-light:has(input:checked) {
    @apply bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400;
  }

  .theme-radio-light input:checked + .theme-radio-content .theme-icon,
  .theme-radio-light:has(input:checked) .theme-icon {
    @apply text-yellow-500 dark:text-yellow-400;
  }

  .theme-radio-light input:checked + .theme-radio-content .theme-label-text,
  .theme-radio-light:has(input:checked) .theme-label-text {
    @apply font-semibold text-blue-600 dark:text-blue-400;
  }

  /* Dark mode active state */
  .theme-radio-dark input:checked + .theme-radio-content,
  .theme-radio-dark:has(input:checked) {
    @apply bg-gray-900 text-gray-100 dark:bg-gray-700 dark:text-gray-100;
  }

  .theme-radio-dark input:checked + .theme-radio-content .theme-icon,
  .theme-radio-dark:has(input:checked) .theme-icon {
    @apply text-yellow-400;
  }

  .theme-radio-dark input:checked + .theme-radio-content .theme-label-text,
  .theme-radio-dark:has(input:checked) .theme-label-text {
    @apply font-semibold text-gray-100;
  }

  /* Default states */
  .theme-radio-light:not(:has(input:checked)) input:not(:checked) + .theme-radio-content {
    @apply text-gray-600 dark:text-gray-400;
  }

  .theme-radio-light:not(:has(input:checked)) .theme-icon,
  .theme-radio-light input:not(:checked) + .theme-radio-content .theme-icon {
    @apply text-gray-500 dark:text-gray-500;
  }

  .theme-radio-dark:not(:has(input:checked)) input:not(:checked) + .theme-radio-content {
    @apply text-gray-600 dark:text-gray-400;
  }

  .theme-radio-dark:not(:has(input:checked)) .theme-icon,
  .theme-radio-dark input:not(:checked) + .theme-radio-content .theme-icon {
    @apply text-gray-500 dark:text-gray-500;
  }

  /* Mobile-specific: Make selected state more visible */
  @media (max-width: 768px) {
    .theme-radio-light input:checked + .theme-radio-content,
    .theme-radio-light:has(input:checked) {
      @apply bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-300;
      @apply ring-2 ring-blue-500 dark:ring-blue-400;
    }

    .theme-radio-dark input:checked + .theme-radio-content,
    .theme-radio-dark:has(input:checked) {
      @apply bg-gray-800 text-white dark:bg-gray-600 dark:text-white;
      @apply ring-2 ring-gray-400 dark:ring-gray-300;
    }

    .theme-label-text {
      @apply text-xs sm:text-sm;
    }
  }

  /* Focus states */
  .theme-radio-label:focus-within {
    @apply ring-2 ring-blue-500 ring-offset-2 dark:ring-blue-400;
  }

  /* Smooth transitions */
  .theme-radio-label {
    @apply transition-all duration-200 ease-in-out;
  }
</style>
